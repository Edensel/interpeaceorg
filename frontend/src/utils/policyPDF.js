import { jsPDF } from 'jspdf';

const POLICY_TEXT = `
IPASUD KENYA — DATA PROTECTION POLICY
Inter-Peace Agency for Sustainable Development (IPASUD) Kenya

Version: 1.0 | Effective Date: 1 January 2026 | Review Date: 1 January 2027

━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━

1. INTRODUCTION & COMMITMENT

Inter-Peace Agency for Sustainable Development Kenya (hereinafter "IPASUD Kenya", "we", "our", or "the Organisation") is committed to protecting the privacy and personal data of all individuals whose information we collect, process, or store. This Data Protection Policy ("Policy") is established in compliance with the Kenya Data Protection Act, 2019 (Act No. 24 of 2019) and the Kenya Data Protection (General) Regulations, 2021.

IPASUD Kenya recognises that the right to privacy is a fundamental human right enshrined in Article 31 of the Constitution of Kenya. We are committed to processing personal data lawfully, fairly, and transparently, and to ensuring that all data subjects can exercise their rights effectively.

This Policy applies to all staff, volunteers, contractors, partners, donors, programme beneficiaries, and any other individuals whose personal data IPASUD Kenya processes.

━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━

2. LEGAL BASIS & DEFINITIONS

Under the Kenya Data Protection Act, 2019, the following definitions apply:

"Personal Data" means any information relating to an identified or identifiable natural person (data subject).
"Processing" means any operation performed on personal data, including collection, recording, storage, use, disclosure, or erasure.
"Data Subject" means any identified or identifiable natural person to whom personal data relates.
"Data Controller" means a natural or legal person who determines the purposes and means of processing personal data. IPASUD Kenya acts as the Data Controller for all personal data processed under this Policy.
"Sensitive Personal Data" includes data revealing health status, ethnic or racial origin, religious or philosophical beliefs, financial information, HIV status, and trade union membership.

Our lawful bases for processing personal data include:
(a) Consent — where the data subject has given explicit consent;
(b) Contractual necessity — where processing is necessary for the performance of a contract;
(c) Legal obligation — where processing is required by law;
(d) Vital interests — where processing is necessary to protect someone's life;
(e) Legitimate interests — where processing is necessary for IPASUD Kenya's legitimate organisational interests, provided these do not override the data subject's rights.

━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━

3. CATEGORIES OF PERSONAL DATA COLLECTED

IPASUD Kenya collects and processes the following categories of personal data:

(a) Staff and Volunteer Data:
• Full name, national ID/passport number, date of birth
• Contact details (phone, email, physical address)
• Employment history, qualifications, and references
• Bank account details for payroll purposes
• Emergency contact information
• Leave records, performance appraisals, and disciplinary records

(b) Programme Beneficiary Data:
• Full name, age, gender, and community of origin
• Household composition and vulnerability status
• Health and nutritional status (where relevant to programme)
• GPS coordinates of household or community (anonymised where possible)
• Programme participation records and outcome data

(c) Donor Data:
• Full name and contact information
• Donation history and payment details
• Communication preferences
• Source of funds declarations (for due diligence)

(d) Website Visitor Data:
• IP address and browser information (via cookies)
• Pages visited and time spent on site
• Contact form submissions
• Newsletter subscription information

━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━

4. PURPOSE OF DATA PROCESSING

We process personal data for the following purposes:

(a) Programme delivery and impact monitoring;
(b) Staff recruitment, management, and development;
(c) Donor relationship management and fundraising;
(d) Financial management, auditing, and accountability;
(e) Communications, reporting, and advocacy;
(f) Research and learning for programme improvement;
(g) Compliance with legal and regulatory obligations;
(h) Website analytics and improvement;
(i) Partnership management and due diligence.

━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━

5. DATA PROTECTION PRINCIPLES

IPASUD Kenya processes all personal data in accordance with the following principles, as required by Section 25 of the Kenya Data Protection Act, 2019:

(a) Lawfulness, Fairness, and Transparency — We collect and process personal data lawfully, fairly, and in a transparent manner.

(b) Purpose Limitation — We collect personal data for specified, explicit, and legitimate purposes, and do not process it in a manner incompatible with those purposes.

(c) Data Minimisation — We collect only the personal data that is adequate, relevant, and limited to what is necessary for the stated purpose.

(d) Accuracy — We take reasonable steps to ensure that personal data is accurate and kept up to date.

(e) Storage Limitation — We retain personal data only for as long as necessary for the stated purpose, or as required by law. See Section 9 for retention periods.

(f) Integrity and Confidentiality — We process personal data in a manner that ensures appropriate security, including protection against unauthorised or unlawful processing, accidental loss, destruction, or damage.

(g) Accountability — IPASUD Kenya, as the Data Controller, is responsible for and can demonstrate compliance with these principles.

━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━

6. DATA SUBJECT RIGHTS

In accordance with Part IV of the Kenya Data Protection Act, 2019, all data subjects have the following rights:

(a) Right of Access — You have the right to request a copy of the personal data IPASUD Kenya holds about you.
(b) Right to Rectification — You have the right to request correction of inaccurate or incomplete personal data.
(c) Right to Erasure — You have the right to request deletion of your personal data where it is no longer necessary, or where you withdraw consent.
(d) Right to Restriction of Processing — You have the right to request that we restrict the processing of your personal data in certain circumstances.
(e) Right to Data Portability — Where processing is based on consent or contract and is carried out by automated means, you have the right to receive your data in a structured, commonly used format.
(f) Right to Object — You have the right to object to processing based on legitimate interests or for direct marketing purposes.
(g) Right not to be Subject to Automated Decision-Making — IPASUD Kenya does not use automated decision-making processes that produce legal or similarly significant effects.

To exercise any of these rights, please contact:
Data Protection Officer
IPASUD Kenya
Email: info@interpeaceagency.org
Phone: +254 716 397 042
Address: Lodwar Town, Turkana County, Kenya

We will respond to all requests within 30 days as required by the Act.

━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━

7. SENSITIVE DATA & SPECIAL PROTECTIONS

IPASUD Kenya works with vulnerable populations in conflict-affected areas. We take additional precautions when processing sensitive personal data, including:

• Beneficiary data linked to health, displacement, and conflict experiences — all such records are anonymised or pseudonymised in research outputs;
• Photography and video of beneficiaries — we obtain informed consent before using any images, and we never publish identifiable images of children without parent/guardian consent;
• Financial data of donors — all payment information is encrypted in transit and processed through PCI-DSS compliant payment processors;
• Staff medical information — held only by HR and relevant medical staff, not shared without written consent.

For programme beneficiaries in remote communities, we obtain oral informed consent in the appropriate local language, with the process witnessed and documented by a community leader or IPASUD Kenya staff member.

━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━

8. DATA SHARING & INTERNATIONAL TRANSFERS

IPASUD Kenya may share personal data with:

(a) Programme donors and funders — only aggregated, anonymised data unless specifically required and consented to;
(b) Government and county authorities — where required by law or for programme coordination;
(c) Partner organisations — only where necessary for joint programme delivery, under data sharing agreements;
(d) Auditors and accountants — for financial accountability purposes;
(e) Service providers (e.g., IT systems, payroll) — under binding data processing agreements.

Where personal data is transferred outside Kenya, we ensure the receiving country has adequate data protection laws, or we implement appropriate safeguards such as standard contractual clauses.

We do not sell, rent, or trade personal data to any third party for commercial purposes.

━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━

9. DATA RETENTION PERIODS

IPASUD Kenya retains personal data as follows:

• Staff employment records — 7 years after end of employment
• Programme beneficiary data — 5 years after programme end, or as required by donor
• Donor records — 7 years (for financial audit purposes)
• Job application records (unsuccessful) — 6 months
• Website contact form submissions — 2 years
• Newsletter subscriptions — until unsubscribed, then 6 months
• Accounting and financial records — 7 years (as required by Kenyan law)

After the retention period expires, data is securely deleted or anonymised.

━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━

10. COOKIES & WEBSITE DATA

IPASUD Kenya's website uses cookies to improve user experience and analyse site traffic. We use:

(a) Essential Cookies — Required for basic site functionality (session cookies, security tokens).
(b) Analytics Cookies — Used to understand how visitors use our site. We use privacy-friendly analytics that anonymise IP addresses.

Users may accept or reject non-essential cookies via the cookie consent banner. Essential cookies cannot be disabled without affecting site functionality. For more details, see our Cookie Policy.

━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━

11. DATA SECURITY

IPASUD Kenya implements appropriate technical and organisational security measures to protect personal data, including:

• Encryption of data in transit (HTTPS/SSL) and at rest for sensitive records;
• Access controls — staff can only access data necessary for their role;
• Regular security training for all staff;
• Password policies and multi-factor authentication for systems holding personal data;
• Regular data backups stored securely;
• Incident response procedures for data breaches.

In the event of a data breach that risks the rights of data subjects, IPASUD Kenya will notify the Office of the Data Protection Commissioner (ODPC) within 72 hours, and affected data subjects without undue delay, as required by Section 43 of the Kenya Data Protection Act.

━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━

12. COMPLAINTS

If you believe IPASUD Kenya has violated your data protection rights, you may:

(a) Contact our Data Protection Officer at info@interpeaceagency.org; or
(b) Lodge a complaint with the Office of the Data Protection Commissioner (ODPC):
    Website: www.odpc.go.ke
    Email: info@odpc.go.ke
    Address: Nairobi, Kenya

━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━

13. POLICY REVIEW

This Policy will be reviewed annually and updated as needed to reflect changes in law, technology, or organisational practice. Staff will be informed of material updates. The current version is always available on our website.

━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━

IPASUD Kenya — Inter-Peace Agency for Sustainable Development
Lodwar Town, Turkana County, Kenya
info@interpeaceagency.org | +254 716 397 042
www.interpeaceagency.org

© 2026 IPASUD Kenya. All rights reserved.
`;

export function openPolicyPDF() {
    const doc = new jsPDF({ orientation: 'portrait', unit: 'mm', format: 'a4' });
    const pageW = doc.internal.pageSize.getWidth();
    const pageH = doc.internal.pageSize.getHeight();
    const margin = 22;
    const contentW = pageW - margin * 2;
    let y = margin;

    function addPage() {
        doc.addPage();
        y = margin;
        doc.setDrawColor(200);
        doc.setLineWidth(0.3);
        doc.line(margin, pageH - 14, pageW - margin, pageH - 14);
        doc.setFontSize(7.5);
        doc.setFont('helvetica', 'normal');
        doc.setTextColor(150);
        doc.text('IPASUD Kenya — Data Protection Policy v1.0 — Effective 1 January 2026', margin, pageH - 9);
        doc.text(`Page ${doc.getNumberOfPages()}`, pageW - margin, pageH - 9, { align: 'right' });
    }

    function checkY(needed) {
        if (y + needed > pageH - 20) addPage();
    }

    // ── Cover Page ──────────────────────────────────────────────────────────
    doc.setFillColor(13, 36, 64);
    doc.rect(0, 0, pageW, pageH, 'F');
    doc.setFillColor(232, 160, 32);
    doc.rect(0, 0, 8, pageH, 'F');
    doc.setTextColor(255, 255, 255);
    doc.setFontSize(28);
    doc.setFont('helvetica', 'bold');
    doc.text('IPASUD KENYA', margin + 4, 55);
    doc.setFontSize(11);
    doc.setFont('helvetica', 'normal');
    doc.setTextColor(180, 200, 220);
    doc.text('Inter-Peace Agency for Sustainable Development', margin + 4, 65);
    doc.setDrawColor(232, 160, 32);
    doc.setLineWidth(1);
    doc.line(margin + 4, 72, pageW - margin, 72);
    doc.setTextColor(255, 255, 255);
    doc.setFontSize(22);
    doc.setFont('helvetica', 'bold');
    doc.text('DATA PROTECTION POLICY', margin + 4, 90);
    doc.setFontSize(12);
    doc.setFont('helvetica', 'normal');
    doc.setTextColor(180, 200, 220);
    doc.text('Compliant with the Kenya Data Protection Act, 2019', margin + 4, 100);
    doc.setFillColor(26, 58, 92);
    doc.roundedRect(margin + 4, 116, contentW - 8, 42, 3, 3, 'F');
    doc.setFontSize(10);
    const meta = [
        ['Version', '1.0'],
        ['Effective Date', '1 January 2026'],
        ['Review Date', '1 January 2027'],
        ['Data Controller', 'IPASUD Kenya'],
    ];
    meta.forEach(([label, value], i) => {
        const row = 126 + i * 9;
        doc.setFont('helvetica', 'bold');
        doc.setTextColor(232, 160, 32);
        doc.text(label + ':', margin + 10, row);
        doc.setFont('helvetica', 'normal');
        doc.setTextColor(255, 255, 255);
        doc.text(value, margin + 50, row);
    });
    doc.setFontSize(9);
    doc.setTextColor(120, 150, 180);
    doc.text('info@interpeaceagency.org  |  +254 716 397 042  |  www.interpeaceagency.org', margin + 4, pageH - 20);
    doc.text('Lodwar Town, Turkana County, Kenya', margin + 4, pageH - 13);

    // ── Policy Pages ─────────────────────────────────────────────────────────
    addPage();
    doc.setFillColor(26, 58, 92);
    doc.rect(0, 0, pageW, 14, 'F');
    doc.setFillColor(232, 160, 32);
    doc.rect(0, 0, 5, 14, 'F');
    doc.setFontSize(8);
    doc.setFont('helvetica', 'bold');
    doc.setTextColor(255, 255, 255);
    doc.text('IPASUD KENYA — DATA PROTECTION POLICY', 10, 9);
    y = 24;

    const renderSection = (num, title, content) => {
        checkY(20);
        doc.setFillColor(245, 248, 252);
        doc.roundedRect(margin - 2, y - 4, contentW + 4, 11, 2, 2, 'F');
        doc.setFillColor(232, 160, 32);
        doc.roundedRect(margin - 2, y - 4, 8, 11, 2, 2, 'F');
        doc.setFontSize(11);
        doc.setFont('helvetica', 'bold');
        doc.setTextColor(26, 58, 92);
        doc.text(`${num}. ${title}`, margin + 10, y + 3.5);
        y += 16;
        doc.setFontSize(9.5);
        doc.setFont('helvetica', 'normal');
        doc.setTextColor(40, 40, 40);
        content.split('\n').forEach(line => {
            line = line.trim();
            if (!line || line.startsWith('━')) return;
            checkY(8);
            const isBullet = line.startsWith('•') || line.startsWith('(');
            const indent = isBullet ? margin + 4 : margin;
            const width = isBullet ? contentW - 4 : contentW;
            const lines = doc.splitTextToSize(line, width);
            lines.forEach(l => {
                checkY(6);
                doc.text(l, indent, y);
                y += 5.5;
            });
            y += 1;
        });
        y += 5;
    };

    const rawSections = POLICY_TEXT.split(/(?=\d+\. [A-Z]{2,})/).filter(s => s.trim() && /^\d+\./.test(s.trim()));
    rawSections.forEach(sec => {
        const lines = sec.trim().split('\n');
        const titleMatch = lines[0].match(/^(\d+)\. (.+)$/);
        if (titleMatch) {
            renderSection(titleMatch[1], titleMatch[2].trim(), lines.slice(1).join('\n'));
        }
    });

    // ── Closing card ─────────────────────────────────────────────────────────
    checkY(30);
    doc.setFillColor(13, 36, 64);
    doc.roundedRect(margin - 2, y, contentW + 4, 28, 3, 3, 'F');
    doc.setFontSize(9);
    doc.setFont('helvetica', 'bold');
    doc.setTextColor(232, 160, 32);
    doc.text('Data Protection Officer', margin + 4, y + 8);
    doc.setFont('helvetica', 'normal');
    doc.setTextColor(200, 215, 230);
    doc.text('info@interpeaceagency.org  |  +254 716 397 042  |  Lodwar Town, Turkana County, Kenya', margin + 4, y + 16);
    doc.setTextColor(120, 150, 180);
    doc.setFontSize(8);
    doc.text('© 2026 IPASUD Kenya. All rights reserved.', margin + 4, y + 23);

    // Open as PDF preview in new tab — no file download
    const pdfBlob = doc.output('blob');
    const url = URL.createObjectURL(pdfBlob);
    window.open(url, '_blank');
    setTimeout(() => URL.revokeObjectURL(url), 60000);
}
